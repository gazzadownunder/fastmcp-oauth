{
  "auth": {
    "trustedIDPs": [
      {
        "name": "requestor-jwt",
        "issuer": "http://localhost:8080/realms/mcp_security",
        "discoveryUrl": "http://localhost:8080/realms/mcp_security/.well-known/openid-configuration",
        "jwksUri": "http://localhost:8080/realms/mcp_security/protocol/openid-connect/certs",
        "audience": "mcp-oauth",
        "algorithms": ["RS256"],
        "claimMappings": {
          "legacyUsername": "legacy_name",
          "roles": "roles",
          "scopes": "scope",
          "userId": "sub",
          "username": "preferred_username"
        },
        "roleMappings": {
          "admin": ["admin", "administrator", "realm-admin", "mcp-oauth-admin"],
          "user": ["user", "authenticated"],
          "write": ["mcp-oauth-write"],
          "read": ["mcp-oauth-read"],
          "guest": ["guest", "anonymous"],
          "defaultRole": "guest"
        },
        "security": {
          "clockTolerance": 60,
          "maxTokenAge": 3600,
          "requireNbf": false
        }
      }
    ],
    "rateLimiting": {
      "enabled": true,
      "maxRequests": 1000,
      "windowMs": 900000
    },
    "audit": {
      "enabled": true,
      "logAllAttempts": true,
      "retentionDays": 90
    }
  },
  "delegation": {
    "modules": {
      "kerberos": {
        "enabled": true,
        "_comment": "Kerberos delegation ENABLED - Requires Active Directory configured at 192.168.1.25",
        "domainController": "w25-dc.w25ad.net",
        "servicePrincipalName": "HTTP/mcp-server",
        "realm": "w25ad.net",
        "kdc": "w25-dc.w25ad.ne:88",
        "enableS4U2Self": true,
        "enableS4U2Proxy": true,
        "allowedDelegationTargets": [
          "cifs/fileserver.w25-dc.w25ad.ne",
          "cifs/192.168.1.25",
          "HOST/fileserver.w25-dc.w25ad.ne",
          "HOST/192.168.1.25"
        ],
        "_comment_targets": "File server SPNs - cifs for SMB/CIFS, HOST for generic host services",
        "serviceAccount": {
          "username": "svc-mcp-server",
          "password": "YourSecurePassword123!",
          "_comment_keytabPath": "For Linux: use /etc/keytabs/mcp-server.keytab instead of password"
        },
        "ticketCache": {
          "enabled": true,
          "ttlSeconds": 3600,
          "renewThresholdSeconds": 300,
          "maxEntriesPerSession": 10,
          "sessionTimeoutMs": 900000
        }
      }
    }
  },
  "mcp": {
    "serverName": "MCP OAuth Kerberos Test Server",
    "version": "3.0.0",
    "transport": "http-stream",
    "port": 3010,
    "enabledTools": {
      "health-check": true,
      "user-info": true,
      "audit-log": true,
      "kerberos-delegate": true,
      "_comment": "Kerberos tool ENABLED - Can test S4U2Self and S4U2Proxy delegation"
    },
    "oauth": {
      "scopes": [
        "openid",
        "profile",
        "kerberos:delegate"
      ]
    }
  },
  "_readme": {
    "description": "Kerberos-only test configuration for MCP OAuth Server",
    "prerequisites": [
      "1. Active Directory configured at 192.168.1.25 (run scripts/setup-ad-kerberos.ps1)",
      "2. Service account svc-mcp-server@COMPANY.COM created with delegation enabled",
      "3. Keycloak configured with legacy_name claim mapper",
      "4. Test users (alice, bob, charlie) have sAMAccountName attribute set"
    ],
    "usage": "set CONFIG_PATH=./test-harness/config/phase3-kerberos-enabled.json && npm start",
    "startup_script": "test-harness/start-kerberos-server.bat"
  }
}
