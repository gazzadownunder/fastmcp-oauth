{
  "auth": {
    "trustedIDPs": [
      {
        "name": "requestor-jwt",
        "issuer": "http://192.168.1.137:8080/realms/mcp_security",
        "discoveryUrl": "http://192.168.1.137:8080/realms/mcp_security/.well-known/openid-configuration",
        "jwksUri": "http://192.168.1.137:8080/realms/mcp_security/protocol/openid-connect/certs",
        "clientId": "mcp-oauth",
        "audience": "mcp-oauth",
        "scope": "openid profile",
        "_note": "This is the IDP for USER AUTHENTICATION (Step 2) - use mcp-oauth public client",
        "algorithms": ["RS256"],
        "claimMappings": {
          "legacyUsername": "legacy_name",
          "roles": "roles",
          "scopes": "scope",
          "userId": "sub",
          "username": "preferred_username"
        },
        "roleMappings": {
          "admin": ["admin", "administrator", "realm-admin", "mcp-oauth-admin"],
          "user": ["user", "authenticated"],
          "write": ["mcp-oauth-write"],
          "read": ["mcp-oauth-read"],
          "guest": ["guest", "anonymous"],
          "defaultRole": "guest",
          "rejectUnmappedRoles": true
        },
        "security": {
          "clockTolerance": 60,
          "maxTokenAge": 3600,
          "requireNbf": false
        }
      },
      {
        "name": "sql-delegation-te-jwt",
        "_comment": "Token Exchange JWT for PostgreSQL1 (primary database)",
        "issuer": "http://192.168.1.137:8080/realms/mcp_security",
        "discoveryUrl": "http://192.168.1.137:8080/realms/mcp_security/.well-known/openid-configuration",
        "jwksUri": "http://192.168.1.137:8080/realms/mcp_security/protocol/openid-connect/certs",
        "audience": "mcp-server-client",
        "algorithms": ["RS256"],
        "claimMappings": {
          "legacyUsername": "legacy_name",
          "roles": "roles",
          "scopes": "scope",
          "userId": "sub",
          "username": "preferred_username"
        },
        "roleMappings": {
          "sql-read": ["sql-read", "alice_table"],
          "sql-write": ["sql-write", "bob_table"],
          "sql-admin": ["sql-admin"],
          "admin": ["admin"],
          "alice-table": ["alice_table"],
          "bob-table": ["bob_table"],
          "guest": ["guest"],
          "defaultRole": "guest",
          "rejectUnmappedRoles": false
        },
        "security": {
          "clockTolerance": 60,
          "maxTokenAge": 3600,
          "requireNbf": false
        }
      },
      {
        "name": "sql2-delegation-te-jwt",
        "_comment": "Token Exchange JWT for PostgreSQL2 (analytics database) - client: second_sql",
        "issuer": "http://192.168.1.137:8080/realms/mcp_security",
        "discoveryUrl": "http://192.168.1.137:8080/realms/mcp_security/.well-known/openid-configuration",
        "jwksUri": "http://192.168.1.137:8080/realms/mcp_security/protocol/openid-connect/certs",
        "audience": "second_sql",
        "algorithms": ["RS256"],
        "claimMappings": {
          "legacyUsername": "legacy_name",
          "roles": "roles",
          "scopes": "scope",
          "userId": "sub",
          "username": "preferred_username"
        },
        "roleMappings": {
          "analyst": ["data_analyst"],
          "viewer": ["read_only"],
          "guest": ["guest"],
          "defaultRole": "guest",
          "rejectUnmappedRoles": true
        },
        "security": {
          "clockTolerance": 60,
          "maxTokenAge": 3600,
          "requireNbf": false
        }
      }
    ],
    "rateLimiting": {
      "enabled": true,
      "maxRequests": 1000,
      "windowMs": 900000
    },
    "audit": {
      "enabled": true,
      "logAllAttempts": true,
      "retentionDays": 90
    }
  },
  "delegation": {
    "_DEPRECATED_tokenExchange": {
      "_comment": "DEPRECATED: Global token exchange config removed in v3.1. Use per-module tokenExchange instead (see postgresql.tokenExchange, kerberos.tokenExchange below)."
    },
    "modules": {
      "postgresql1": {
        "_comment": "PRIMARY DATABASE - Main PostgreSQL database",
        "host": "localhost",
        "port": 5432,
        "database": "postgres",
        "user": "mcp_service",
        "password": "ServicePass123!",
        "options": {
          "ssl": false
        },
        "pool": {
          "max": 10,
          "min": 0,
          "idleTimeoutMillis": 30000,
          "connectionTimeoutMillis": 5000
        },
        "tokenExchange": {
          "_comment": "Per-module token exchange (Phase 2: v3.1+)",
          "idpName": "sql-delegation-te-jwt",
          "tokenEndpoint": "http://192.168.1.137:8080/realms/mcp_security/protocol/openid-connect/token",
          "clientId": "mcp-server-client",
          "clientSecret": "sVJvwv0AllnSw64MUggSk9NS2ifteLQK",
          "audience": "mcp-server-client",
          "scope": "openid profile",
          "requiredClaim": "legacy_name",
          "rolesClaim": "roles",
          "cache": {
            "enabled": true,
            "ttlSeconds": 60,
            "sessionTimeoutMs": 900000,
            "maxEntriesPerSession": 10,
            "maxTotalEntries": 1000
          }
        }
      },
      "postgresql2": {
        "_comment": "SECONDARY DATABASE - Analytics/Testing database",
        "host": "localhost",
        "port": 5432,
        "database": "contextflow_ai",
        "user": "postgres",
        "password": "Letmein",
        "options": {
          "ssl": false
        },
        "pool": {
          "max": 5,
          "min": 0,
          "idleTimeoutMillis": 30000,
          "connectionTimeoutMillis": 5000
        },
        "tokenExchange": {
          "_comment": "Per-module token exchange (Phase 2: v3.1+) - Analytics database with read-only scope",
          "idpName": "sql2-delegation-te-jwt",
          "tokenEndpoint": "http://192.168.1.137:8080/realms/mcp_security/protocol/openid-connect/token",
          "clientId": "second_sql",
          "clientSecret": "tErtusngY6ukdctJL7Ouy8oImZK9wHe4",
          "audience": "second_sql",
          "scope": "openid profile",
          "requiredClaim": "legacy_name",
          "cache": {
            "enabled": true,
            "ttlSeconds": 60,
            "sessionTimeoutMs": 900000,
            "maxEntriesPerSession": 10,
            "maxTotalEntries": 1000
          }
        }
      },
      "_kerberos": {
        "enabled": true,
        "_comment_enabled": "Kerberos delegation ENABLED - Requires Active Directory at w25-dc.w25ad.net",
        "domainController": "w25-dc.w25ad.net",
        "servicePrincipalName": "host/mcp-server",
        "realm": "w25ad.net",
        "kdc": "w25-dc.w25ad.net:88",
        "enableS4U2Self": true,
        "enableS4U2Proxy": true,
        "allowedDelegationTargets": [
          "cifs/fileserver.w25ad.net",
          "cifs/192.168.1.25",
          "HOST/fileserver.w25ad.net",
          "HOST/192.168.1.25"
        ],
        "_comment_targets": "File server SPNs for Windows file share access via SMB/CIFS",
        "serviceAccount": {
          "username": "svc-mcp-server",
          "password": "YourSecurePassword123!",
          "_comment_keytabPath": "For Linux: use /etc/keytabs/mcp-server.keytab instead of password"
        },
        "ticketCache": {
          "enabled": true,
          "ttlSeconds": 3600,
          "renewThresholdSeconds": 300,
          "maxEntriesPerSession": 10,
          "sessionTimeoutMs": 900000
        },
        "tokenExchange": {
          "_comment": "Per-module token exchange for Kerberos (Phase 2: v3.1+)",
          "idpName": "sql-delegation-te-jwt",
          "tokenEndpoint": "http://192.168.1.137:8080/realms/mcp_security/protocol/openid-connect/token",
          "clientId": "mcp-server-client",
          "clientSecret": "sVJvwv0AllnSw64MUggSk9NS2ifteLQK",
          "audience": "mcp-server-client",
          "requiredClaim": "legacy_name",
          "cache": {
            "enabled": true,
            "ttlSeconds": 60,
            "sessionTimeoutMs": 900000,
            "maxEntriesPerSession": 10,
            "maxTotalEntries": 1000
          }
        }
      }
    }
  },
  "mcp": {
    "serverName": "MCP OAuth Phase 3 Test Server (Cache Enabled)",
    "version": "3.0.0",
    "transport": "http-stream",
    "port": 3000,
    "enabledTools": {
      "sql1-delegate": true,
      "sql1-schema": true,
      "sql1-table-details": true,
      "sql2-delegate": true,
      "sql2-schema": true,
      "sql2-table-details": true,
      "health-check": true,
      "user-info": true,
      "audit-log": true,
      "_kerberos-list-directory": true,
      "_kerberos-read-file": true,
      "_kerberos-file-info": true,
      "_comment_sql": "SQL1 tools connect to primary database (postgres), SQL2 tools connect to analytics database (analytics_db)",
      "_comment_kerberos": "Kerberos tools automatically perform delegation (S4U2Self/S4U2Proxy) when called. Token exchange provides legacy_name claim."
    },
    "oauth": {
      "scopes": [
        "openid"
      ]
    }
  }
}
