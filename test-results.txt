
> fastmcp-oauth-obo@2.0.0 test
> vitest --run --reporter=verbose


[1m[7m[36m RUN [39m[27m[22m [36mv2.1.9 [39m[90mc:/Users/gazza/Local Documents/GitHub/MCP Services/MCP-Oauth[39m

 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mNull Object Pattern[2m > [22mshould work without configuration (disabled by default)
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mNull Object Pattern[2m > [22mshould not crash with undefined config
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mNull Object Pattern[2m > [22mshould not log when disabled
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mEnabled Audit Logging[2m > [22mshould log entries when enabled
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mEnabled Audit Logging[2m > [22mshould add timestamp if missing
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mEnabled Audit Logging[2m > [22mshould log multiple entries
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mMANDATORY (GAP #3): Source Field Validation[2m > [22mshould throw if source field is missing
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mMANDATORY (GAP #3): Source Field Validation[2m > [22mshould accept entries with source field
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mMANDATORY (GAP #3): Source Field Validation[2m > [22mshould track source field values correctly
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mMANDATORY (GAP #7): Overflow Handling[2m > [22mshould call onOverflow callback when capacity reached
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mMANDATORY (GAP #7): Overflow Handling[2m > [22mshould pass ALL entries to onOverflow before discarding
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mMANDATORY (GAP #7): Overflow Handling[2m > [22mshould remove oldest entry after overflow
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mMANDATORY (GAP #7): Overflow Handling[2m > [22mshould work without onOverflow callback
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mMANDATORY (GAP #7): Overflow Handling[2m > [22mshould call onOverflow multiple times on multiple overflows
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mIn-Memory Storage Limit[2m > [22mshould default to 10,000 entry limit
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mIn-Memory Storage Limit[2m > [22mshould maintain max entries limit
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mCustom Storage[2m > [22mshould accept custom storage implementation
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mCustom Storage[2m > [22mshould support async storage implementations
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mWrite-Only API Design[2m > [22mshould NOT expose query methods on AuditService
 [32mâœ“[39m tests/unit/core/audit-service.test.ts[2m > [22mAuditService[2m > [22mWrite-Only API Design[2m > [22mshould only expose log() method publicly
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mModule Imports[2m > [22mshould import MCP types
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mvalidate()[2m > [22mshould succeed with all required fields present
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mvalidate()[2m > [22mshould throw on missing authService
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mvalidate()[2m > [22mshould throw on missing auditService
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mvalidate()[2m > [22mshould throw on missing delegationRegistry
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mvalidate()[2m > [22mshould throw on missing configManager
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mvalidate()[2m > [22mshould throw on null context
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mvalidate()[2m > [22mshould throw on undefined context
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mvalidate()[2m > [22mshould throw on empty object
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22misValid()[2m > [22mshould return true for valid CoreContext
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22misValid()[2m > [22mshould return false for missing authService
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22misValid()[2m > [22mshould return false for null
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22misValid()[2m > [22mshould return false for undefined
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22misValid()[2m > [22mshould return false for empty object
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22misValid()[2m > [22mshould return false for non-object values
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mArchitectural Integrity[2m > [22mshould import CoreContext from core layer (not MCP)
 [32mâœ“[39m tests/unit/core/validators.test.ts[2m > [22mCoreContextValidator[2m > [22mArchitectural Integrity[2m > [22mshould enforce one-way dependency flow
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mModule Imports[2m > [22mshould import MCPAuthMiddleware
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mCRITICAL: Never Throws Policy[2m > [22mshould NEVER throw on any input
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mCRITICAL: Never Throws Policy[2m > [22mshould return UNASSIGNED_ROLE on invalid input
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mCRITICAL: Never Throws Policy[2m > [22mshould return UNASSIGNED_ROLE with failure reason on error
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mDefault Configuration[2m > [22mshould use default role mappings when no config provided
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mDefault Configuration[2m > [22mshould map admin roles correctly
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mDefault Configuration[2m > [22mshould map user roles correctly
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mDefault Configuration[2m > [22mshould return default role when no matches
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mPriority-Based Role Assignment[2m > [22mshould prioritize admin over user
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mPriority-Based Role Assignment[2m > [22mshould prioritize user over guest
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mPriority-Based Role Assignment[2m > [22mshould follow priority order: admin > user > guest
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mCustom Role Mappings[2m > [22mshould support custom role mappings
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mCustom Role Mappings[2m > [22mshould prioritize standard roles over custom roles
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mCustom Role Mappings[2m > [22mshould include custom roles in customRoles array
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mCustom Role Mappings[2m > [22mshould not duplicate primary role in customRoles
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mEdge Cases[2m > [22mshould handle empty roles array
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mEdge Cases[2m > [22mshould filter out null/undefined values
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mEdge Cases[2m > [22mshould filter out empty strings
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mEdge Cases[2m > [22mshould handle roles with special characters
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mConfiguration Updates[2m > [22mshould allow configuration updates
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mConfiguration Updates[2m > [22mshould merge configuration updates
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mDefault Role Behavior[2m > [22mshould use custom default role when configured
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mDefault Role Behavior[2m > [22mshould use ROLE_GUEST as default when not configured
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mComplex Scenarios[2m > [22mshould handle multiple custom roles correctly
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mComplex Scenarios[2m > [22mshould handle case-sensitive role names
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mValidation Results[2m > [22mshould set mappingFailed to false on success
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mValidation Results[2m > [22mshould set mappingFailed to true on error
 [32mâœ“[39m tests/unit/core/role-mapper.test.ts[2m > [22mRoleMapper[2m > [22mValidation Results[2m > [22mshould include failure reason when mapping fails
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Creation[2m > [22mshould create session with admin role and permissions
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Creation[2m > [22mshould create session with user role and permissions
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Creation[2m > [22mshould create session with guest role and permissions
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mCRITICAL: UNASSIGNED_ROLE Policy (GAP #2)[2m > [22mshould create UNASSIGNED_ROLE session with empty permissions
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mCRITICAL: UNASSIGNED_ROLE Policy (GAP #2)[2m > [22mshould throw if UNASSIGNED_ROLE has non-empty permissions (safety check)
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mRejection Tracking (GAP #1)[2m > [22mshould set rejected=true for UNASSIGNED_ROLE
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mRejection Tracking (GAP #1)[2m > [22mshould set rejected=false for valid roles
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Versioning (GAP #6)[2m > [22mshould add _version field to new sessions
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Versioning (GAP #6)[2m > [22mshould return current version number
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Migration (GAP #6)[2m > [22mshould migrate v0 session to v1 (add _version field)
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Migration (GAP #6)[2m > [22mshould add rejected=true for v0 UNASSIGNED_ROLE sessions
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Migration (GAP #6)[2m > [22mshould ensure UNASSIGNED_ROLE has empty permissions after migration
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Migration (GAP #6)[2m > [22mshould add default permissions for v0 sessions missing permissions
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Migration (GAP #6)[2m > [22mshould not modify already migrated sessions (v1)
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Validation[2m > [22mshould validate non-UNASSIGNED sessions as valid
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mSession Validation[2m > [22mshould validate UNASSIGNED sessions as invalid
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mCustom Permissions[2m > [22mshould support custom role permissions
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mCustom Permissions[2m > [22mshould return empty permissions for unknown custom roles
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mCustom Roles[2m > [22mshould include custom roles in session
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mScopes Handling[2m > [22mshould convert space-separated scopes to array
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mScopes Handling[2m > [22mshould handle scopes already as array
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mScopes Handling[2m > [22mshould handle missing scopes
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mUsername Fallbacks[2m > [22mshould prefer preferred_username over username
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mUsername Fallbacks[2m > [22mshould fall back to username if preferred_username missing
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mUsername Fallbacks[2m > [22mshould fall back to sub if no username fields present
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mConfiguration Updates[2m > [22mshould allow updating permission configuration
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mConfiguration Updates[2m > [22mshould merge configuration updates
 [32mâœ“[39m tests/unit/core/session-manager.test.ts[2m > [22mSessionManager[2m > [22mClaims Preservation[2m > [22mshould preserve all JWT claims in session
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mToken Extraction[2m > [22mshould extract Bearer token from Authorization header
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mToken Extraction[2m > [22mshould handle Authorization header (capital A)
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mToken Extraction[2m > [22mshould return error if Authorization header is missing
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mToken Extraction[2m > [22mshould return error if Bearer token format is invalid
 [31mÃ—[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mDual Rejection Checks (GAP #1)[2m > [22mshould reject if authResult.rejected is true
[31m   â†’ expected 'Authentication rejected' to contain 'Unassigned role'[39m
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mDual Rejection Checks (GAP #1)[2m > [22mshould reject if session.rejected is true (GAP #1)
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mDual Rejection Checks (GAP #1)[2m > [22mshould accept if both checks pass
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mContext Creation[2m > [22mshould create MCPContext from successful auth result
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mContext Creation[2m > [22mshould throw if auth result is not authenticated
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mAuthorization Helpers[2m > [22mrequireAuth[2m > [22mshould pass for authenticated session
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mAuthorization Helpers[2m > [22mrequireAuth[2m > [22mshould throw for rejected session
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mAuthorization Helpers[2m > [22mrequireRole[2m > [22mshould pass for matching role
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mAuthorization Helpers[2m > [22mrequireRole[2m > [22mshould throw for non-matching role
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mAuthorization Helpers[2m > [22mrequireRole[2m > [22mshould throw for rejected session
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mAuthorization Helpers[2m > [22mrequirePermission[2m > [22mshould pass for granted permission
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mAuthorization Helpers[2m > [22mrequirePermission[2m > [22mshould throw for missing permission
 [32mâœ“[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mAuthorization Helpers[2m > [22mrequirePermission[2m > [22mshould throw for rejected session
 [32mâœ“[39m tests/unit/config/migrate.test.ts[2m > [22mConfig Migration[2m > [22mmigrateConfig[2m > [22mshould migrate legacy config to unified format
 [32mâœ“[39m tests/unit/config/migrate.test.ts[2m > [22mConfig Migration[2m > [22mmigrateConfig[2m > [22mshould migrate config with only auth fields
 [32mâœ“[39m tests/unit/config/migrate.test.ts[2m > [22mConfig Migration[2m > [22mmigrateConfig[2m > [22mshould migrate config with SQL delegation
 [32mâœ“[39m tests/unit/config/migrate.test.ts[2m > [22mConfig Migration[2m > [22mmigrateConfig[2m > [22mshould migrate config with Kerberos delegation
 [32mâœ“[39m tests/unit/config/migrate.test.ts[2m > [22mConfig Migration[2m > [22mmigrateConfig[2m > [22mshould handle rate limiting migration
 [32mâœ“[39m tests/unit/config/migrate.test.ts[2m > [22mConfig Migration[2m > [22mmigrateConfig[2m > [22mshould preserve all IDP configurations
 [32mâœ“[39m tests/unit/config/migrate.test.ts[2m > [22mConfig Migration[2m > [22mmigrateConfig[2m > [22mshould add default MCP config
 [32mâœ“[39m tests/unit/config/migrate.test.ts[2m > [22mConfig Migration[2m > [22mmigrateConfig[2m > [22mshould validate migrated config
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mCoreAuthConfigSchema[2m > [22mshould validate valid core auth config
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mCoreAuthConfigSchema[2m > [22mshould reject config with HTTP URLs in production
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mCoreAuthConfigSchema[2m > [22mshould reject config with insecure algorithms
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mCoreAuthConfigSchema[2m > [22mshould accept minimal config with only required fields
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mDelegationConfigSchema[2m > [22mshould validate valid delegation config
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mDelegationConfigSchema[2m > [22mshould accept empty modules
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mDelegationConfigSchema[2m > [22mshould validate SQL config with authentication
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mMCPConfigSchema[2m > [22mshould validate valid MCP config
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mMCPConfigSchema[2m > [22mshould use default values
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mMCPConfigSchema[2m > [22mshould validate transport type
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mUnifiedConfigSchema[2m > [22mshould validate complete unified config
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mUnifiedConfigSchema[2m > [22mshould validate config with only auth section
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mUnifiedConfigSchema[2m > [22mshould reject config without auth section
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mType Guards[2m > [22misLegacyConfig[2m > [22mshould detect legacy config format
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mType Guards[2m > [22misLegacyConfig[2m > [22mshould reject unified config format
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mType Guards[2m > [22misUnifiedConfig[2m > [22mshould detect unified config format
 [32mâœ“[39m tests/unit/config/schemas.test.ts[2m > [22mConfig Schemas[2m > [22mType Guards[2m > [22misUnifiedConfig[2m > [22mshould reject legacy config format
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mModule Imports[2m > [22mshould import core module[33m 493[2mms[22m[39m
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mModule Imports[2m > [22mshould export CoreContext type
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mModule Imports[2m > [22mshould export all core services
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mModule Imports[2m > [22mshould export role constants
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mCoreContextValidator Usage[2m > [22mshould validate valid CoreContext
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mCoreContextValidator Usage[2m > [22mshould reject invalid CoreContext
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mCoreContextValidator Usage[2m > [22mshould use isValid type guard
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mRole Mapper Standalone[2m > [22mshould create and use RoleMapper without dependencies
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mRole Mapper Standalone[2m > [22mshould handle role mapping failure gracefully
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mSession Manager Standalone[2m > [22mshould create sessions without dependencies
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mSession Manager Standalone[2m > [22mshould migrate old session schemas
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mAudit Service Standalone[2m > [22mshould use Null Object Pattern when disabled
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mAudit Service Standalone[2m > [22mshould log when enabled
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mFull Authentication Flow (Mocked)[2m > [22mshould perform full auth flow without MCP
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mType Exports[2m > [22mshould export all necessary types
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mArchitectural Integrity[2m > [22mshould not import from MCP layer
 [32mâœ“[39m tests/integration/core/standalone.test.ts[2m > [22mCore Module Standalone Integration[2m > [22mArchitectural Integrity[2m > [22mshould export CoreContext from Core layer (GAP #Architecture)
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mConstruction and Initialization[2m > [22mshould create service with configuration
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mConstruction and Initialization[2m > [22mshould create service with custom audit service
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mConstruction and Initialization[2m > [22mshould use Null Object Pattern for audit service if not provided
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mConfiguration Management[2m > [22mshould allow updating role mappings configuration
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mConfiguration Management[2m > [22mshould allow updating permissions configuration
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mAuthentication Flow (Mocked)[2m > [22mshould orchestrate JWT validation, role mapping, and session creation
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mAuthentication Flow (Mocked)[2m > [22mshould return rejected session for UNASSIGNED_ROLE without throwing
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mCRITICAL: Rejection Policy (GAP #1)[2m > [22mshould NOT throw on UNASSIGNED_ROLE, return rejected=true instead
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mCRITICAL: Rejection Policy (GAP #1)[2m > [22mshould include rejection reason in result
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mCRITICAL: Audit Source Field (GAP #3)[2m > [22mshould include source="auth:service" in audit entry on success
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mCRITICAL: Audit Source Field (GAP #3)[2m > [22mshould include source="auth:service" in audit entry on rejection
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mCRITICAL: Audit Source Field (GAP #3)[2m > [22mshould include source="auth:service" in audit entry on error
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mError Handling[2m > [22mshould throw on JWT validation failure
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mError Handling[2m > [22mshould log audit entry before throwing JWT error
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mAudit Entry Validation[2m > [22mshould return audit entry in successful result
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mAudit Entry Validation[2m > [22mshould include metadata in audit entry
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mResource Cleanup[2m > [22mshould clean up resources on destroy
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mRole Array Extraction[2m > [22mshould extract roles from string in claims
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mRole Array Extraction[2m > [22mshould handle array of roles in claims
 [32mâœ“[39m tests/unit/core/authentication-service.test.ts[2m > [22mAuthenticationService[2m > [22mRole Array Extraction[2m > [22mshould handle missing roles claim
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mInitialization[2m > [22mshould initialize with IDP configurations
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mInitialization[2m > [22mshould throw if not initialized before validateJWT
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mInitialization[2m > [22mshould not re-initialize if already initialized
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mToken Format Validation[2m > [22mshould validate token has three parts
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mToken Format Validation[2m > [22mshould reject empty token
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mToken Format Validation[2m > [22mshould reject token with only two parts
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mToken Format Validation[2m > [22mshould reject token with four parts
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mToken Claim Extraction[2m > [22mshould extract issuer and audience from valid token
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mToken Claim Extraction[2m > [22mshould reject token missing issuer claim
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mToken Claim Extraction[2m > [22mshould reject token missing audience claim
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mIssuer Validation[2m > [22mshould reject tokens from untrusted issuers
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mSecurity Requirements Validation[2m > [22mshould validate algorithm is in allowed list
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mSecurity Requirements Validation[2m > [22mshould enforce clock tolerance
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mSecurity Requirements Validation[2m > [22mshould enforce max token age
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mSecurity Requirements Validation[2m > [22mshould enforce nbf requirement
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mClaim Mapping[2m > [22mshould have claim mappings configured
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mClaim Mapping[2m > [22mshould support custom claim paths
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mResource Cleanup[2m > [22mshould have destroy method
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mResource Cleanup[2m > [22mshould clean up resources on destroy
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mError Handling[2m > [22mshould throw OAuthSecurityError for security violations
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mError Handling[2m > [22mshould throw on malformed JWT payload
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mIntegration with IDPConfig[2m > [22mshould support multiple IDPs
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mIntegration with IDPConfig[2m > [22mshould validate HTTPS requirement for JWKS URI
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mRFC 8725 Compliance[2m > [22mshould only allow secure algorithms
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mRFC 8725 Compliance[2m > [22mshould enforce token expiration
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mRFC 8725 Compliance[2m > [22mshould support clock tolerance for time-based claims
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mValidation Result Structure[2m > [22mshould return JWTValidationResult on success
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mEdge Cases[2m > [22mshould handle base64url encoding correctly
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mEdge Cases[2m > [22mshould handle array audience claim
 [32mâœ“[39m tests/unit/core/jwt-validator.test.ts[2m > [22mJWTValidator[2m > [22mEdge Cases[2m > [22mshould handle string audience claim
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mModule Imports[2m > [22mshould import ConfigOrchestrator[33m 527[2mms[22m[39m
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Registration[2m > [22mshould register a module
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Registration[2m > [22mshould throw if module already registered
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Registration[2m > [22mshould log registration event to audit service
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Unregistration[2m > [22mshould unregister a module
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Unregistration[2m > [22mshould return false when unregistering non-existent module
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Unregistration[2m > [22mshould log unregistration event
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Listing[2m > [22mshould list all registered modules
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Listing[2m > [22mshould return empty array when no modules registered
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mDelegation Routing[2m > [22mshould delegate to correct module
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mDelegation Routing[2m > [22mshould return error for non-existent module
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mDelegation Routing[2m > [22mshould log module not found to audit service
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mCRITICAL: Audit Source Field (GAP #3)[2m > [22mshould add source field if module did not provide it
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mCRITICAL: Audit Source Field (GAP #3)[2m > [22mshould preserve source field from module if provided
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mCRITICAL: Audit Source Field (GAP #3)[2m > [22mshould log all delegation attempts with source field
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Initialization[2m > [22mshould initialize all modules with configs
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Initialization[2m > [22mshould throw if module config missing
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Initialization[2m > [22mshould throw if any module initialization fails
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Destruction[2m > [22mshould destroy all modules
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mModule Destruction[2m > [22mshould continue destroying even if one module fails
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mHealth Checks[2m > [22mshould check health of all modules
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mHealth Checks[2m > [22mshould return false for unhealthy module
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mHealth Checks[2m > [22mshould return false if health check throws
 [32mâœ“[39m tests/unit/delegation/registry.test.ts[2m > [22mDelegationRegistry[2m > [22mNull Object Pattern[2m > [22mshould work without audit service
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mModule Imports[2m > [22mshould import tool factories
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mPublic API Exports[2m > [22mshould export all MCP public APIs
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mPublic API Exports[2m > [22mshould NOT re-export CoreContext (architectural integrity)
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mCore Layer Integration[2m > [22mshould import CoreContext from Core layer
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mCore Layer Integration[2m > [22mshould be able to use CoreContext with MCP types
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mModule Imports[2m > [22mshould import delegation module[33m 1916[2mms[22m[39m
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mModule Imports[2m > [22mshould export DelegationRegistry
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mModule Imports[2m > [22mshould export SQLDelegationModule
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mModule Imports[2m > [22mshould export delegation types
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mDelegationRegistry Standalone[2m > [22mshould create registry without dependencies
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mDelegation Layer Integration[2m > [22mshould be able to use DelegationRegistry from MCP layer[33m 1208[2mms[22m[39m
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mArchitectural Integrity[2m > [22mshould NOT import from MCP in Core layer
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mArchitectural Integrity[2m > [22mshould verify one-way dependency flow: Core â†’ Delegation â†’ MCP
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mLLM Response Standards (GAP #5)[2m > [22mshould define LLMSuccessResponse format
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mLLM Response Standards (GAP #5)[2m > [22mshould define LLMFailureResponse format
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mMCPContext and ToolHandler Types (GAP #12)[2m > [22mshould define MCPContext with session field
 [32mâœ“[39m tests/integration/mcp/standalone.test.ts[2m > [22mMCP Layer - Standalone Integration[2m > [22mMCPContext and ToolHandler Types (GAP #12)[2m > [22mshould define ToolHandler signature
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mDelegationRegistry Standalone[2m > [22mshould create registry with Core AuditService
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mSQL Delegation Module Creation[2m > [22mshould create SQL module
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mSQL Delegation Module Creation[2m > [22mshould have required DelegationModule methods
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mModule Registration Flow[2m > [22mshould register SQL module with registry
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mModule Registration Flow[2m > [22mshould list registered modules
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mIntegration with Core[2m > [22mshould integrate with Core AuditService
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mIntegration with Core[2m > [22mshould accept Core UserSession in delegate calls
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mAccess Validation[2m > [22mshould validate session has legacyUsername for SQL
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mHealth Checks[2m > [22mshould return false when not initialized
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mArchitectural Integrity[2m > [22mshould not import from MCP layer
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mArchitectural Integrity[2m > [22mshould be able to import from Core layer
 [32mâœ“[39m tests/integration/delegation/standalone.test.ts[2m > [22mDelegation Layer Standalone Integration[2m > [22mAudit Trail Compliance (GAP #3)[2m > [22mshould create audit trails with source field

[31mâ¯â¯â¯â¯â¯â¯â¯[1m[7m Failed Tests 1 [27m[22mâ¯â¯â¯â¯â¯â¯â¯[39m

[31m[1m[7m FAIL [27m[22m[39m tests/unit/mcp/middleware.test.ts[2m > [22mMCP Middleware[2m > [22mMCPAuthMiddleware[2m > [22mDual Rejection Checks (GAP #1)[2m > [22mshould reject if authResult.rejected is true
[31m[1mAssertionError[22m: expected 'Authentication rejected' to contain 'Unassigned role'[39m

Expected: [32m"Unassigned role"[39m
Received: [31m"Authentication rejected"[39m

[36m [2mâ¯[22m tests/unit/mcp/middleware.test.ts:[2m150:30[22m[39m
    [90m148| [39m        [34mexpect[39m(result[33m.[39mauthenticated)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m149| [39m        [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m150| [39m        [34mexpect[39m(result[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'Unassigned role'[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m151| [39m      })[33m;[39m
    [90m152| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (13)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m254 passed[39m[22m[90m (255)[39m
[2m   Start at [22m 17:00:53
[2m   Duration [22m 3.52s[2m (transform 6.62s, setup 0ms, collect 10.95s, tests 5.65s, environment 11ms, prepare 6.03s)[22m

